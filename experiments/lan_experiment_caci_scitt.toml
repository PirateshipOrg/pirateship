workdir = "deployment_artifacts"
project_home = "https://github.com/grapheo12/pirateship"

[deployment_config]
type = "caci"
mode = "lan"
ssh_pub_key = "cluster_key_pub.pem"
ssh_key = "cluster_key.pem"
ssh_user = "pftadmin"
node_port_base = 3000
template = "arm-template.json"
registry_name = "tjgoncalvesregistry"
resource_group = "t-jgoncalves-group"
image_name = "pftimage"
local = false
docker_ssh = 2222
confidential = true

[node_config]

[node_config.net_config]
client_max_retry = 10

[node_config.rpc_config]
recv_buffer_size = 32768
channel_depth = 1000

[node_config.consensus_config]
commit_index_gap_soft = 250
commit_index_gap_hard = 500
liveness_u = 2
max_backlog_batch_size = 1000
signature_max_delay_blocks = 10
# signature_max_delay_ms = 102 # roughly batch_max_delay_ms * signature_max_delay_blocks
signature_max_delay_ms = 100 # roughly batch_max_delay_ms * signature_max_delay_blocks
num_crypto_workers = 5
view_timeout_ms = 4000
# batch_max_delay_ms = 2
batch_max_delay_ms = 10

[node_config.consensus_config.log_storage_config.RocksDB]
write_buffer_size = 2147483648
max_write_buffer_number = 1
max_write_buffers_to_merge = 1

[node_config.app_config]
logger_stats_report_ms = 100
checkpoint_interval_ms = 120000
validation_workers = 4

[node_config.evil_config]
simulate_byzantine_behavior = false
byzantine_start_block = 0


[client_config]
full_duplex = true
client_sub_id = 0       # This is filled up later by the caller code.

[client_config.net_config]
client_max_retry = 10

[client_config.workload_config]
num_requests = 100_000_000
request_config = "Blanks"
max_concurrent_requests = 32

# [[experiments]]
# name = "scitt_audit"
# type = "scitt"
# repeats = 3
# num_nodes = 7 
# duration = 60
# node_distribution = "uniform"
# build_command = "make pirateship_scitt"
# measure_resources = true
# 
# [experiments.sweeping_parameters]
# num_clients = [10, 50, 100, 200, 300, 400, 500]
# 
# [[experiments]]
# name = "scitt_slow_audit"
# type = "scitt"
# repeats = 3
# num_nodes = 7 
# duration = 60
# node_distribution = "uniform"
# build_command = "make pirateship_scitt_nofast"
# measure_resources = true
# 
# [experiments.sweeping_parameters]
# num_clients = [10, 50, 100, 200, 300, 400, 500]
# #num_clients = [10, 50, 100]

[[experiments]]
name = "scitt_concurrent_slow_audit"
type = "scitt"
#repeats = 3
repeats = 1
num_nodes = 7 
duration = 60
node_distribution = "uniform"
build_command = "make pirateship_scitt_concurrent_nofast"
measure_resources = true

[experiments.sweeping_parameters]
num_clients = [10, 50, 100, 200, 300, 400, 500]
#num_clients = [10, 50, 100]

[[experiments]]
name = "scitt_commit"
type = "scitt"
#repeats = 3
repeats = 1
num_nodes = 7 
duration = 60
node_distribution = "uniform"
build_command = "make pirateship_scitt_concurrent_commit_receipts"
measure_resources = true

[experiments.sweeping_parameters]
num_clients = [10, 50, 100, 200, 300, 400, 500]
#num_clients = [10, 50, 100, 200]

[[experiments]]
name = "scitt_concurrent_audit"
type = "scitt"
#repeats = 3
repeats = 1
num_nodes = 7 
duration = 60
node_distribution = "uniform"
build_command = "make pirateship_scitt_concurrent"
measure_resources = true

[experiments.sweeping_parameters]
num_clients = [10, 50, 100, 200, 300, 400, 500]
#num_clients = [10, 50, 100, 200]

# [[experiments]]
# name = "scitt_concurrent_commit"
# type = "scitt"
# repeats = 1
# num_nodes = 7 
# duration = 60
# node_distribution = "uniform"
# build_command = "make pirateship_scitt_concurrent_commit_receipts"
# measure_resources = true
# 
# [experiments.sweeping_parameters]
# num_clients = [10, 50, 100, 200, 300, 400, 500]
# #num_clients = [10, 50, 100, 200]

# [[experiments]]
# name = "scitt_ccf_7"
# type = "ccf"
# repeats = 1
# num_nodes = 7 
# duration = 60
# measure_resources = true
# 
# [experiments.node_config]
# sig_tx_count = 100
# sig_delay = "50ms"
# worker_threads = 14
# historical_cache_soft_limit = "1GB"
# curve_id = "Secp256R1"

# [experiments.sweeping_parameters]
# num_clients = [10, 50, 100, 200, 300, 400, 500]

[[experiments]]
name = "scitt_ccf_5"
type = "ccf"
#repeats = 3
repeats = 1
num_nodes = 5 
duration = 60
measure_resources = true

[experiments.node_config]
sig_tx_count = 100
sig_delay = "50ms"
worker_threads = 14
historical_cache_soft_limit = "1GB"
curve_id = "Secp256R1"

[experiments.sweeping_parameters]
num_clients = [10, 50, 100, 200, 300, 400, 500]


# [[experiments]]
# name = "scitt_ccf_5_10"
# type = "ccf"
# repeats = 3
# num_nodes = 5 
# duration = 60
# measure_resources = true
# 
# [experiments.node_config]
# sig_tx_count = 100
# sig_delay = "10ms"
# worker_threads = 14
# historical_cache_soft_limit = "1GB"
# curve_id = "Secp256R1"
# 
# [experiments.sweeping_parameters]
# num_clients = [10, 50, 100, 200, 300, 400, 500]

[[results]]
name = "scitt_comp"
plotter = "tput_latency_sweep_locust"
ramp_up = 25
ramp_down = 15
output = "scitt_comp.pdf"
force_parse = true
# skip_indices = [2]

[results.legends]
# Experiment group to legend mapping
# scitt_audit = "PS SCITT Seq Audit Nodes=7"
scitt_commit = "Pirateship CTS Commit"
# scitt_slow_audit = "Pirateship CTS Slow Audit"
scitt_concurrent_slow_audit = "Pirateship CTS Slow Audit"
scitt_concurrent_audit = "Pirateship CTS Audit"
scitt_ccf_5 = "CCF CTS"
#scitt_ccf_7 = "CCF SCITT"

#   [[results]]
#   name = "resource_usage"
#   plotter = "resource_timeseries"
#   ramp_up = 0
#   ramp_down = 0
#   output = "resources"
#   force_parse = true

[results.font]
size = 55