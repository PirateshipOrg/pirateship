// Copyright (c) Shubham Mishra. All rights reserved.
// Licensed under the MIT License.

syntax = "proto3";

package proto.client;
import "execution.proto";
import "consensus.proto";

message ProtoClientRequest {
    // This structure is temporary. It MUST change.
    proto.execution.ProtoTransaction tx = 1;
    string origin = 2;
    bytes sig = 3;
    uint64 client_tag = 4;
}

message ProtoByzResponse {
    uint64 block_n = 1;
    uint64 tx_n = 2;
    uint64 client_tag = 3;
    // bytes req_digest = 3;
}

message ProtoTransactionResponse {
    // this became a `response` as opposed to a `receipt` because it is not transmissible
    // i.e. this proves to the client that the transaction was crash committed (TLS connection)
    // but it not signed and thus cannot be used by the client to prove the transaction was crash committed to a third party
    bytes req_digest = 1;
    uint64 block_n = 2;
    uint64 tx_n = 3;
    proto.execution.ProtoTransactionResult results = 4;
    repeated ProtoByzResponse byz_responses = 5;
}

message ProtoTransactionReceipt {
    repeated proto.consensus.ProtoBlock chain = 1;
    repeated bytes proof = 2;
    repeated proto.consensus.ProtoQuorumCertificate qcs = 3;
}

message ProtoTentativeResponse {
    uint64 block_n = 1;
    uint64 tx_n = 2;
}

message ProtoTryAgain { 
    string serialized_node_infos = 1;
}

message ProtoCurrentLeader {
    string name = 1;
    string serialized_node_infos = 2;
}

message ProtoClientReply {
    oneof reply {
        ProtoTransactionResponse response = 1;
        ProtoTryAgain try_again = 2;
        ProtoCurrentLeader leader = 3;
        ProtoTentativeResponse tentative_response = 4; 
        ProtoTransactionReceipt commit_receipt = 5;
        ProtoTransactionReceipt audit_receipt = 6;
    }
    uint64 client_tag = 7;
}

message ProtoByzPollRequest {
    uint64 block_n = 1;
    uint64 tx_n = 2;
}
